<html>
<body>
	<div>
		<?php include('head.php');?>	
		<div>
			<h3>Поиск товаров</h3>
			<form action="search.php" method="get">
				<div>
					<div>
						<input class="content-input" size="140" name="product_name" placeholder="Наименование" value="" aria-describedby="name-format">
					</div>	
					<div>
						<input type="submit"/>
					</div>
				</div>
			</form>
			<?php
			if($_GET['product_name']){ 
				$db = new PDO('mysql:host=10.254.254.53;port=3307;dbname=sql_injection', "root", ""); 
				$product = $_GET['product_name'];
				$product = htmlspecialchars($product);
				$stmt = $db->prepare("SELECT name, count FROM products WHERE products.name = :product");
				$stmt->BindParam(':product', $product);
				$stmt->execute();
				if($stmt->rowCount() > 0){
					printf('
					<table border="1">
					<caption>Результат поиска по запросу '.$product.'</caption>
					<tr>
					<th>Товар</th>
					<th>Количество</th>
					</tr> ');
					while($row = $stmt->fetch()) {
						printf('
						<tr>
						<td align="center" width="100">'.$row['name'].'</td>
						<td align="center" width="100">'.$row['count'].'</td>
						</tr> ');
					}
				}
				else printf('<p>Поиск по запросу '.$product.' не дал результатов</p>');	
			}
			?>
		</div>
	</div>
</body>

</html>