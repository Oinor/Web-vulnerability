<?php
session_start();
if($_GET['do'] == 'logout'){
	session_destroy();
	header("Location: index.php");
}
include('head.php');
if($_POST['enter']){		
	$log = $_POST['user'];
	$pass = $_POST['pass'];
	$db = new PDO('mysql:host=10.254.254.53;port=3307;dbname=sql_injection', "root", "");
	$stmt = $db->prepare("SELECT * FROM users	WHERE users.login = :login AND users.password = :password");
	$stmt->BindParam(':login', $log);
	$stmt->BindParam(':password', $pass);
	$stmt->execute();
	if($stmt->rowCount() > 0){
	$row = $stmt->fetch();
	$_SESSION['id'] = $row['id'];
	$_SESSION['name'] = $row['login'];
	}else echo '<p>Логин или пароль неверны!</p>';
}
if(!$_SESSION['id']){
	printf('
	<form method="post">
	<div>Логин:</div>
	<div><input type="text" name="user" /></div>
	<div>Пароль:</div>
	<div><input type="password" name="pass" /></div>
	<p><input type="submit" name="enter" value="Войти" /></p>
	</form>');
}
else printf('<p>Вы вошли под пользователем '.$_SESSION['name'].'</p><a href="index.php?do=logout">Выход</a>');

?>

